# 寻找性能测试瓶颈--并发数、TPS、响应时间

1. 三者关系图

![img](.\img\Center)

2.  结论
小并发数区间测试，找拐点（如：100-300并发持续5分钟，可以发现上图中200并发时出现拐点）
大并发数区间测试，找符合需求的最大并发数（如：1800-2200并发持续5分钟，可以找到满足响应时间在3秒内的最大并发数2000）
利用最大并发数，压测环境在极限时的资源消耗（压测时间1小时以内）
80%最大并发数，进行稳定性测试（压测时间1小时以上）
注：执行机资源消耗必须监控上，保证能提供稳定的并发负载。

注：这里的响应时间是90%响应时间



并发数

并发数是指系统同时能处理的请求数量，这个也是反应了系统的负载能力

吞吐量
吞吐量是指单位时间内系统能处理的请求数量，体现系统处理请求的能力，这是目前最常用的性能测试指标

响应时间RT(Response-time)
响应时间是一个系统最重要的指标之一，它的数值大小直接反应了系统的快慢。响应时间是指执行一个请求从开始到最后收到响应数据所花费的总体时间,即从客户端发起请求到收到服务器响应结果的时间

QPS(Queries Per Second)
是每秒查询率，是一台服务器每秒能够相应的查询次数，即1秒内完成的请求数量，是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准

TPS(TransactionsPerSecond)
也就是事物数/秒。它是软件测试结果的测量单位。一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程。客户机在发送请时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数

Qps基本类似于Tps，但是不同的是，对于一个页面的一次访问，形成一个Tps；但一次页面请求，可能产生多次对服务器的请求，服务器对这些请求，就可计入“Qps”之中
例：访问一个页面会请求服务器3次，一次放，产生一个“T”，产生3个“Q”

之间的计算关系：
QPS = 并发量 / 平均响应时间
并发量 = QPS * 平均响应时间


举个例子来理解下上述几个概念。
假设每天80%的访问集中在20%的时间里，这20%时间叫做峰值时间
公式：( 总PV数 * 80% ) / ( 每天秒数 * 20% ) = 峰值时间每秒请求数(QPS)
机器：峰值时间每秒QPS / 单台机器的QPS = 需要的机器

每天300w PV 的在单台机器上，这台机器需要多少QPS？
( 3000000 * 0.8 ) / (86400 * 0.2 ) = 139 (QPS)

如果一台机器的QPS是58，需要几台机器来支持？
139 / 58 = 3

HPS：Hits per Second 每秒点击次数

是指在一秒钟的时间内用户对Web页面的链接、提交按钮等点击总和。 它一般和TPS成正比关系，是B/S系统中非常重要的性能指标之一。

throughput：分为网络吞吐量和事务吞吐量，当作为事务吞吐量时，采用TPS来衡量。